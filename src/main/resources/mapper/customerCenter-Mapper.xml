<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 모든 SQL문을 mapper태그 안에 작성 -->
<mapper namespace="customerCenterMapper">
	
	<!-- 고객센터 게시글 -->
	<resultMap type="com.kh.project.customerCenter.vo.CustomerCenterVO" id="customer">
		<id column="CUSTOMER_CODE"			property="customerCode"/>
		<result column="CREATE_DATE"		property="createDate"/>
		<result column="WRITER"				property="writer"/>
		<result column="TITLE"				property="title"/>
		<result column="CONTENT"			property="content"/>
		<result column="IS_READ"			property="isRead"/>
		<result column="IS_NOTICE"			property="isNotice"/>
		<result column="SECRET_NUMBER"		property="secretNumber"/>
	</resultMap>
	
	<!-- 고객센터 댓글 -->
	<resultMap type="com.kh.project.customerCenter.vo.CustomerCenterReplyVO" id="CustomerReply">
		<id column="CUSTOMER_REPLY_CODE"		property="customerReplyCode"/>
		<result column="CREATE_DATE"			property="createDate"/>
		<result column="WRITER"					property="writer"/>
		<result column="CONTENT"				property="content"/>
		<result column="IS_CUSTOMER_CODEREAD"	property="customerCode"/>
	</resultMap>
	
	<!-- 고객센터 게시판 조회 -->
	<select id="selectCustomerBoard" resultMap="customer">
		SELECT CUSTOMER_CODE
		    , TO_CHAR(CREATE_DATE, 'YYYY-MM-DD') AS CREATE_DATE
		    , WRITER 
		    , TITLE 
		    , CONTENT 
		    , IS_READ 
		    , SECRET_NUMBER 
		    , IS_NOTICE 
		FROM OISONE_CUSTOMER
		WHERE 1 = 1
		AND IS_NOTICE = 'N'
	</select>
	
	<!-- 고객센터 게시판 글 등록 -->
	<insert id="insertCustomerBoard">
		INSERT INTO OISONE_CUSTOMER(
		    CUSTOMER_CODE 
		    , WRITER 
		    , TITLE 
		    , CONTENT  
		    , SECRET_NUMBER)
		VALUES (
		     (SELECT 'CSB_'||TO_CHAR((SYSDATE), 'YYYYMMDD')||'_'||LPAD(NVL(MAX(TO_NUMBER(SUBSTR(CUSTOMER_CODE,14,3))), 0)+1 , 3, 0) 
		        FROM OISONE_CUSTOMER)
		     , #{writer}
		     , #{title}
		     , #{content}
		     , #{secretNumber}
		)
		
	</insert>
	
	
	<!-- 고객센터 글 상세보기 -->
	<select id="selectCustomerBoardDetail" resultMap="customer">
		SELECT CUSTOMER_CODE 
		    , WRITER 
		    , TITLE 
		    , CONTENT  
		    , SECRET_NUMBER
		FROM OISONE_CUSTOMER
		WHERE CUSTOMER_CODE = #{customerCode}
		AND SECRET_NUMBER = #{secretNumber}
	</select>
		
</mapper>












